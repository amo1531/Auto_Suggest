// Generated by CoffeeScript 1.12.7
(function() {
  var AutoSuggest;

  window.AutoSuggest = AutoSuggest = (function() {
    function AutoSuggest() {
      this.displayDetails;
      this.boxWidth = 0;
      this.countryNames = [];
      this.currentUrl = window.location.href;
    }

    AutoSuggest.prototype.init = function() {
      if (this.currentUrl.indexOf("countryNames=") > -1) {
        this.createBoxOnloadOfPage();
      }
      this.options = {
        url: "./json/countries.json",
        getValue: "country_name",
        list: {
          match: {
            enabled: true
          },
          onChooseEvent: function() {
            var countryname, dialingcode;
            countryname = $("#searchInput").getSelectedItemData().country_name;
            dialingcode = $("#searchInput").getSelectedItemData().dialling_code;
            console.log(countryname + " , " + dialingcode);
            this.displayDetails = '<li class="name"><p><label><strong>Country Name: </strong></label><label class = "countryname" >' + countryname + '</label></p><p class="code"><label><strong>Dialling Code: </strong></label><label class = "dialingcode" >' + dialingcode + '</label></p></li>';
            return $(".Results_list").append(this.displayDetails);
          },
          onClickEvent: (function(_this) {
            return function() {
              return _this.setWidthOfDynamicInputBox();
            };
          })(this)
        }
      };
      $("#searchInput").easyAutocomplete(this.options);
      this.widthOnPageLoad();
      $(".Search_Button").on('click', (function(_this) {
        return function() {
          var advancedUrl, encodedTerm, inputBoxes, modifiedValue, newurl;
          modifiedValue = "";
          inputBoxes = $(".Search_InputWrapper").find(".DynamicInput");
          $.each(inputBoxes, function(index, elements) {
            var searchValue;
            searchValue = $(elements).val();
            if ((modifiedValue.length > 0) && (searchValue.length > 0)) {
              modifiedValue = modifiedValue + " AND ";
            }
            modifiedValue = modifiedValue + searchValue;
            return $(".Results_list").css("display", "block");
          });
          encodedTerm = encodeURIComponent(modifiedValue).replace(/%20/g, '+');
          advancedUrl = _this.buildqueryStringUrl(_this.currentUrl, "countryNames", encodedTerm);
          if (history.pushState) {
            newurl = advancedUrl;
            return window.history.pushState({
              path: newurl
            }, '', newurl);
          }
        };
      })(this));
      $("#searchInput").on('keydown', (function(_this) {
        return function(e) {
          var keyCode;
          keyCode = e.keyCode || e.which;
          if (keyCode === 9) {
            e.preventDefault();
            return _this.setWidthOfDynamicInputBox();
          }
        };
      })(this));
      return $(".Search_InputWrapper").on("click", ".Search_cross", (function(_this) {
        return function(e) {
          var closestEle, res, valueToBeRemoved;
          closestEle = $(e.currentTarget);
          valueToBeRemoved = closestEle.siblings("input").val();
          res = $(".Results_list").find("li .countryname");
          $.each(res, function(index, elements) {
            if (valueToBeRemoved === $(elements).html()) {
              return $(elements).parent().parent().remove();
            }
          });
          return _this.removeItemFromInput(closestEle);
        };
      })(this));
    };

    AutoSuggest.prototype.widthOnPageLoad = function() {
      $(".easy-autocomplete").css("width", "100%");
      return $("#searchInput").css("width", "100%");
    };

    AutoSuggest.prototype.setWidthOfDynamicInputBox = function() {
      var dynamicWidth, searchValue, spanElement;
      searchValue = $("#searchInput").val();
      dynamicWidth = searchValue.length * 8;
      if (searchValue.length > 24) {
        dynamicWidth = searchValue.length * 7;
      } else {
        dynamicWidth = searchValue.length * 8;
      }
      spanElement = this.getInputStructure(dynamicWidth, searchValue);
      $(".easy-autocomplete").prepend(spanElement);
      return this.setWidthOfMainInputBox(dynamicWidth + 24);
    };

    AutoSuggest.prototype.buildqueryStringUrl = function(currenturl, parameter, searchTerm) {
      return currenturl + "?" + parameter + "=" + searchTerm;
    };

    AutoSuggest.prototype.setWidthOfMainInputBox = function(dynamicWidth) {
      this.boxWidth += dynamicWidth;
      if (this.boxWidth > 440) {
        $("#searchInput").css("width", "461px");
        return this.dynamicWidth = 0;
      } else {
        return $("#searchInput").css("width", "calc(100% - " + this.boxWidth + "px)");
      }
    };

    AutoSuggest.prototype.removeItemFromInput = function(current) {
      current.parent("span").next(".DynamicInput").remove();
      return current.parent("span").remove();
    };

    AutoSuggest.prototype.searchForMatchingData = function(value) {
      return $.getJSON('./json/countries.json', (function(_this) {
        return function(data) {
          return $.each(data, function(index, obj) {
            if (value === data[index].country_name) {
              _this.displayDetails = _this.resultDetails(data[index].country_name, data[index].dialling_code);
              $(".Results_list").append(_this.displayDetails);
              return $(".Results_list").css("display", "block");
            }
          });
        };
      })(this));
    };

    AutoSuggest.prototype.getInputStructure = function(dynamicWidth, searchValue) {
      var htmlStructure;
      htmlStructure = '<span class = "SearchSpan" style="width:' + dynamicWidth + 'px" >' + '<input class="Search_Input DynamicInput" " type ="text" value ="' + searchValue + '"/>' + '<a class="Search_cross">Ã—</a>' + '</span>';
      $("#searchInput").val("");
      return $(htmlStructure);
    };

    AutoSuggest.prototype.resultDetails = function(name, code) {
      var result;
      result = '<li class="name">' + '<p>' + '<label><strong>Country Name: </strong></label>' + '<label class = "countryname" >' + name + '</label>' + '</p>' + '<p>' + '<label><strong>Dialling Code: </strong></label>' + '<label class = "dialingcode" >' + code + '</label>' + '</p>' + '</li>';
      return $(result);
    };

    AutoSuggest.prototype.createBoxOnloadOfPage = function() {
      var queryString;
      queryString = this.currentUrl.split('?countryNames=')[1];
      console.log(queryString);
      queryString = queryString.split("+AND+");
      $.each(queryString, (function(_this) {
        return function(index, value) {
          var country;
          country = queryString[index].replace(/\+/g, " ");
          console.log(country);
          _this.countryNames.push(country);
          return _this.searchForMatchingData(country);
        };
      })(this));
      console.log(queryString);
      return $.each(this.countryNames, (function(_this) {
        return function(index, value) {
          var dynamicWidth, spanElement;
          dynamicWidth = _this.countryNames[index].length * 8;
          if (_this.countryNames[index].length > 24) {
            dynamicWidth = _this.countryNames[index].length * 7;
          } else {
            dynamicWidth = _this.countryNames[index].length * 8;
          }
          spanElement = _this.getInputStructure(dynamicWidth, _this.countryNames[index]);
          $(".Search_InputWrapper").prepend(spanElement);
          return _this.setWidthOfMainInputBox(dynamicWidth + 24);
        };
      })(this));
    };

    return AutoSuggest;

  })();

  $(document).ready(function() {
    var autoObject;
    autoObject = new AutoSuggest();
    return autoObject.init();
  });

}).call(this);
